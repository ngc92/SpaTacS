- unify random
- sort energy management code